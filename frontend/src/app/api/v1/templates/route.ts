/**
 * 模板管理API路由
 * 
 * 处理模板相关请求，返回模拟数据
 */

/**
 * GET /api/v1/templates - 获取模板列表
 */
export async function GET() {
  // 模拟模板数据
  const templates = [
    {
      id: 'accident_details',
      title: '事故经过及索赔',
      description: '记录事故发生的详细经过和索赔情况',
      category: 'basic',
      content: `## 事故经过

### 事故时间
[事故发生的具体日期和时间]

### 事故地点
[事故发生的详细地址]

### 事故经过
[详细描述事故发生的过程，包括天气、路况、当事人行为等]

### 索赔情况
[描述索赔的具体情况和金额]`,
      isActive: true,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    },
    {
      id: 'policy_summary',
      title: '保单内容摘要',
      description: '总结保单的关键条款和保险责任',
      category: 'basic',
      content: `## 保单基本信息

### 投保人信息
- 投保人：[投保人姓名/公司名称]
- 联系方式：[电话号码]

### 被保险人信息
- 被保险人：[被保险人姓名/公司名称]
- 关系：[与投保人关系]

### 保险标的
- 保险标的：[保险标的名称和详细描述]
- 保险价值：[保险价值金额]

### 保险责任
- 保险期间：[保险起止日期]
- 保险金额：[保险金额]
- 保险责任：[详细列出保险责任范围]

### 免责条款
[列出主要的免责条款]`,
      isActive: true,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    },
    {
      id: 'site_investigation',
      title: '现场查勘情况',
      description: '记录现场查勘的详细情况和发现',
      category: 'investigation',
      content: `## 现场查勘记录

### 查勘时间
[查勘的具体日期和时间]

### 查勘人员
- 公估师：[姓名、资质]
- 陪同人员：[相关人员信息]

### 现场环境
- 天气状况：[查勘时的天气情况]
- 现场状况：[现场的基本情况描述]

### 查勘发现
#### 损失情况
[详细描述发现的损失情况]

#### 现场痕迹
[记录现场发现的相关痕迹]

#### 拍照取证
[记录拍摄的照片数量和内容]

### 初步结论
[基于现场查勘得出的初步结论]`,
      isActive: true,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    },
    {
      id: 'cause_analysis',
      title: '事故原因分析',
      description: '分析事故发生的原因和责任认定',
      category: 'analysis',
      content: `## 事故原因分析

### 直接原因
[分析事故发生的直接原因]

### 间接原因
[分析可能导致事故的间接因素]

### 责任认定
#### 第一方责任
[分析第一方的责任情况]

#### 第二方责任
[分析第二方的责任情况]

#### 第三方责任
[如有第三方，分析其责任情况]

### 事故性质判定
[判定事故性质：意外事故/自然灾害/人为因素等]

### 与保险责任的关系
[分析事故与保险责任条款的关系]`,
      isActive: true,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    },
    {
      id: 'loss_assessment',
      title: '损失核定',
      description: '评估和核定保险损失金额',
      category: 'assessment',
      content: `## 损失核定

### 损失项目清单
#### 直接损失
[列出直接损失项目和金额]

#### 间接损失
[如适用，列出间接损失项目]

### 损失金额计算
#### 修复费用
- 材料费：[金额]
- 人工费：[金额]
- 其他费用：[金额]

#### 施救费用
[如有施救费用，详细说明]

#### 残值回收
[如有残值，说明回收情况]

### 赔偿建议
#### 应赔金额
[根据保单条款计算的应赔金额]

#### 免赔额
[免赔额的计算和说明]

#### 最终赔付金额
[扣除免赔额后的最终赔付金额]`,
      isActive: true,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    },
    {
      id: 'conclusion',
      title: '公估结论',
      description: '基于调查得出的专业公估结论',
      category: 'conclusion',
      content: `## 公估结论

### 事故认定
[对事故性质和原因的最终认定]

### 损失确认
[确认的损失金额和范围]

### 责任认定
[各方责任的最终认定结果]

### 赔偿建议
#### 保险责任认定
[事故是否属于保险责任范围]

#### 赔偿金额建议
[建议的赔偿金额及计算依据]

#### 特别说明
[如有特殊情况需要说明的事项]

### 公估师意见
[公估师的专业意见和建议]

---
**公估师签名：** [签名]
**日期：** [日期]
**执业证号：** [证号]`,
      isActive: true,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    },
    {
      id: 'complete_report',
      title: '完整保险公估报告',
      description: '标准化的完整保险公估报告模板，包含所有必要章节',
      category: 'comprehensive',
      content: `# 保险公估报告

**编号：** [ZDGG + 年月日 + 地区代码 + 流水号]

**致：** [保险公司名称]

## [被保险人名称][事故日期][事故标的][受损案]

### 摘要

为评估"[被保险人名称][事故日期][事故地点][事故标的][受损案]"一案的保险事故，为[保单号]号保单项下保险赔偿理算提供参考依据，结合委托人处理上述保险事故进行保险公估的需要，受[保险公司名称]委托，我司作为"[案件简称]"一案的保险公估人，秉承独立、客观、公正的公估原则，依据《中华人民共和国保险法》《保险公估基本准则》等法律法规，指派保险公估人员于[查勘日期]前往被保险人位于[事故地址]现场查勘，通过现场查勘、收集相关资料、评定估算损失等公估程序，形成了本公估报告。

---

## 正文

### 一、概述（委托人及委托信息）

**（一）委托人：**
- 名称：[保险公司全名]
- 住所：[保险公司地址]
- 统一社会信用代码：[统一社会信用代码]
- 负责人姓名：[负责人姓名]

**（二）委托目的：** 为委托人处理"[案件全称]"一案的保险事故进行保险赔偿理算提供参考依据

**（三）评估标的：** [保单号]号保单项下承保标的

**（四）委托事项：** 对"[案件全称]"一案的保险事故进行检验、估损、理算，并出具公估报告

**（五）委托日期：** [委托日期]

**（六）报告日期：** [报告出具日期]

### 二、保单内容摘要

**（一）保险人：** [保险公司名称]
**（二）被保险人：** [被保险人名称]
**（三）保险险种：** [险种名称]
**（四）保险单号：** [保险单号]
**（五）被保险人地址：** [被保险人地址]
**（六）被保险项目及保险金额：**
- 建筑物（含装修）：人民币 [金额] 元
- 机器设备：人民币 [金额] 元
- [其他项目]：人民币 [金额] 元

**（七）保险财产地址：** [保险财产地址]
**（八）营业性质：** [营业性质]
**（九）保险期限：** 自[起保日期]起至[终保日期]止
**（十）免赔额：** [免赔额条款详情]
**（十一）特别约定：**
[列出重要的特别约定条款]

### 三、被保险人、保险标的概况

**（一）被保险人——** [被保险人名称]，统一社会信用代码：[代码]，地址：[地址]，经营范围：[经营范围]

**（二）受损财产概况**
[详细描述受损财产的基本情况、位置、用途等]

### 四、事故经过及索赔

据报案人[报案人姓名]介绍：[事故发生时间]，在[事故地点]，[详细描述事故经过]。被保险人得知财产受损后立即向贵司报案、申请索赔。

[委托日期]贵司委托我司作为本案保险公估人，对事故进行检验、估损、理算。

### 五、现场查勘情况

[查勘日期]接贵司委托后，我司立即联系报案人[报案人姓名]，约定时间前往事故现场进行查勘。

我司查勘人员会同被保险人代表[代表姓名]先生对事故进行查勘。事故发生在[事故地点]。

**事故经过详述：**
[详细记录事故发生的时间、地点、经过、原因等]

**现场查勘发现：**
[详细记录现场查勘发现的损失情况、证据材料等]

**受损财产清单：**
| 序号 | 项目 | 查勘数量 | 查勘情形 | 编号 | 备注 |
|------|------|----------|----------|------|------|
| 1 | [受损项目1] | [数量] | [受损情况] | [编号] | [备注] |
| 2 | [受损项目2] | [数量] | [受损情况] | [编号] | [备注] |

**现场查勘照片：**
[描述现场拍摄的照片内容和数量]

### 六、事故原因分析

经我司现场查勘、调取相关记录、向相关人员了解确认：
[详细分析事故发生的原因，包括直接原因和间接原因]

**事故性质认定：**
[根据查勘结果认定事故性质：是否属于意外事故、自然灾害等]

### 七、损失核定

**（一）报损情况**
被保险人取得维修商的报价单，针对本次事故报损金额共计人民币[总金额]元。

**报损明细：**
| 序号 | 项目 | 报损数量 | 报损单价 | 报损金额 | 备注 |
|------|------|----------|----------|----------|------|
| 1 | [项目1] | [数量] | [单价] | [金额] | [备注] |
| 2 | [项目2] | [数量] | [单价] | [金额] | [备注] |
| **合计** | | | | **[总金额]** | |

**（二）核损情况**
我司公估师依据现场查勘情况、保险双方签订的保险合同、收集的资料、市场了解等核定本次事故情况：

**报损、核损对比表：**
| 序号 | 项目 | 查勘数量 | 报损金额 | 核损金额（不含税） | 备注 |
|------|------|----------|----------|-------------------|------|
| 1 | [项目1] | [数量] | [报损金额] | [核损金额] | [备注] |
| 2 | [项目2] | [数量] | [报损金额] | [核损金额] | [备注] |
| **小计** | | | **[报损总额]** | **[核损总额]** | |
| 残值 | | | | [残值金额] | [残值说明] |
| **合计** | | | **[最终报损]** | **[最终核损]** | |

**核损说明：**
1. [详细说明各项目核损的依据和计算过程]
2. [说明残值的处理方式]
3. [其他需要说明的核损情况]

### 八、保险责任确认

**（一）** 本次事故发生于[事故日期]，在保单保险有效期限内。

**（二）** 本次事故发生地位于[事故地点]，属保单约定被保险的财产地址。

**（三）** 经现场查勘结合被保险人提供的资料，本次出险的[受损标的]属保单约定的保险标的。

**（四）** 本次事故原因为[事故原因]，属于[事故性质]，[是否属于保险责任范围的分析]。

**（五）** 无相关责任免除条款适用本次事故。

**（六）** 无其他情况说明被保险人不具有保险利益。

**综合以上情况，我司分析本次事故保单责任成立。**

### 九、保险赔付理算

**（一）是否重复保险**
我司未了解到被保险人持有对本次事故承担责任的其他保单。

**（二）是否足额投保**
[根据保单条款分析是否足额投保，投保比例计算]

**（三）残值**
经前述所述，本案残值为人民币[残值金额]元。

**（四）是否代位追偿**
[分析是否存在第三方责任，是否需要代位追偿]

**（五）免赔金额**
保单约定免赔额：[免赔条款]。本案损失金额为人民币[损失金额]元，因此本案免赔金额为人民币[免赔金额]元。

**（六）理算结果**
**建议理算金额**
= （核损金额 - 残值）× 投保比例 - 免赔金额
= （人民币[核损金额]元 - 人民币[残值金额]元）× [投保比例]% - 人民币[免赔金额]元
= 人民币[净损失]元 - 人民币[免赔金额]元
= **人民币[最终理算金额]元**

### 十、保险公估结论

综上所述，我司对本次保险事故公估结论如下：

**（一）** 贵司应对本次事故负赔偿责任。

**（二）** [如有代位追偿情况的说明]

**（三）** 我司建议贵司理算金额为**人民币[最终金额]元**（大写人民币：[大写金额]）。

### 十一、公估报告依据

本公估报告依据我司公估师的查勘结果，保险人、被保险人及有关方面提供的相关单证资料，结合保险原理评定估算损失等公估程序，遵循《中华人民共和国保险法》《中华人民共和国资产评估法》《保险公估人监管规定》《保险公估基本准则》等法律法规缮制的。

**（一）评估原则**
1. 遵循独立、客观、公正的保险公估原则
2. 遵循客观性、公正性、公平性、科学性的工作原则
3. 遵循最大诚信原则、损失补偿原则、近因原则等保险基本原则

**（二）评估依据**
主要法律法规和参考文件：
1. 《中华人民共和国民法典》
2. 《中华人民共和国保险法》
3. 《中华人民共和国资产评估法》
4. 《保险公估人监管规定》
5. 《保险公估基本准则》
6. 与委托人签署的《公估合作协议》
7. 保险公估人员现场查勘的相关资料

### 十二、本公估报告使用限制说明

**（一）** 本公估报告是在委托人及利害关系人提供的资料、同时结合实地现场查勘、并选择相应估损方法的基础上所形成，结论仅供委托人保险理赔时参考。

**（二）** 委托人及利害关系人，对其所提供资料的真实性、完整性、合法性及其产生的法律后果承担责任。

**（三）** 本公估报告评估基准日为[评估基准日]，除特别指明外，本报告所用货币单位为人民币，货币金额取值至人民币分，进行四舍五入。

**（四）** 除委托人、本报告所涉保险合同当事人和关系人、保险公估委托合同中约定的其他本公估报告使用人，以及法律、行政法规规定的保险公估报告使用人之外，其他任何机构和个人不能成为本公估报告的使用人。

**（五）** 委托人或者其他保险公估报告使用人未按照法律、行政法规规定和保险公估报告载明的使用范围使用本公估报告的，本公司及其公估人员不承担责任。

**（六）** 未经本公司书面同意，任何单位或个人不得将本公估报告用于公开的文件、通告或报告中，亦不得以任何形式公开发表。

---

**公估机构：** [公估机构名称]
**公估师：** [公估师姓名]
**执业证号：** [执业证号]
**报告日期：** [报告日期]

---

*本报告共 __ 页，本页为第 __ 页*`,
      isActive: true,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    }
  ]

  return Response.json({
    success: true,
    data: templates,
    total: templates.length,
    message: '模板列表获取成功'
  })
}

/**
 * POST /api/v1/templates - 创建新模板
 */
export async function POST(request: Request) {
  try {
    const body = await request.json()
    const { title, description, content, category } = body
    
    if (!title || !content) {
      return Response.json({
        success: false,
        error: '标题和内容不能为空',
        message: '请填写模板标题和内容'
      }, { status: 400 })
    }
    
    // 模拟创建模板
    const newTemplate = {
      id: Date.now().toString(),
      title,
      description: description || '',
      content,
      category: category || 'custom',
      isActive: true,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    }
    
    return Response.json({
      success: true,
      data: newTemplate,
      message: '模板创建成功'
    }, { status: 201 })
    
  } catch (error) {
    console.error('创建模板错误:', error)
    return Response.json({
      success: false,
      error: '创建模板失败',
      message: '服务器处理请求时出错'
    }, { status: 500 })
  }
} 