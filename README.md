# å…¬ä¼°æŠ¥å‘Šæ™ºèƒ½æ’°å†™åŠ©æ‰‹

åŸºäºAIæŠ€æœ¯çš„ä¿é™©ç†èµ”å…¬ä¼°æŠ¥å‘Šæ™ºèƒ½ç”Ÿæˆç³»ç»Ÿï¼Œå¸®åŠ©å…¬ä¼°å¸ˆå¿«é€Ÿç”Ÿæˆé«˜è´¨é‡çš„æŠ¥å‘Šåˆç¨¿ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ**: åŸºäºAIæŠ€æœ¯è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šå„ç« èŠ‚å†…å®¹
- **æ–‡ä»¶ç®¡ç†**: æ”¯æŒPDFã€å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ åŠOCRæ–‡å­—è¯†åˆ«
- **æ¨¡æ¿ç®¡ç†**: æä¾›æ ‡å‡†æ¨¡æ¿åº“å’Œè‡ªå®šä¹‰æ¨¡æ¿åŠŸèƒ½  
- **æŠ¥å‘Šç¼–è¾‘**: å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒå®æ—¶ä¿å­˜å’Œåä½œ
- **AIåŠ©æ‰‹**: æ™ºèƒ½å¯¹è¯ï¼Œæä¾›ä¸“ä¸šç†èµ”æŒ‡å¯¼
- **å¤šæ ¼å¼å¯¼å‡º**: æ”¯æŒWordã€PDFæ ¼å¼å¯¼å‡º

### ğŸ”§ æŠ€æœ¯ç‰¹æ€§
- **å‰åç«¯åˆ†ç¦»**: React + Next.jså‰ç«¯ï¼ŒFastAPIåç«¯
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **å®æ—¶åä½œ**: WebSocketå®æ—¶åŒæ­¥
- **å®‰å…¨è®¤è¯**: JWT Tokenè®¤è¯ä½“ç³»
- **é«˜æ€§èƒ½**: Redisç¼“å­˜ï¼Œæ•°æ®åº“ä¼˜åŒ–

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A[React + Next.js]
        B[TypeScript]
        C[Tailwind CSS]
    end
    
    subgraph "APIç½‘å…³"
        D[FastAPI]
        E[JWTè®¤è¯]
        F[CORSä¸­é—´ä»¶]
    end
    
    subgraph "ä¸šåŠ¡æœåŠ¡å±‚"
        G[æŠ¥å‘ŠæœåŠ¡]
        H[æ–‡ä»¶æœåŠ¡]
        I[AIæœåŠ¡]
        J[ç”¨æˆ·æœåŠ¡]
        K[æ¨¡æ¿æœåŠ¡]
    end
    
    subgraph "æ•°æ®å­˜å‚¨å±‚"
        L[PostgreSQL]
        M[Redisç¼“å­˜]
        N[æ–‡ä»¶å­˜å‚¨]
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        O[OpenAI API]
        P[OCRæœåŠ¡]
        Q[é‚®ä»¶æœåŠ¡]
    end
    
    A --> D
    D --> G
    D --> H
    D --> I
    D --> J
    D --> K
    
    G --> L
    H --> L
    I --> O
    H --> P
    
    G --> M
    H --> N
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
pila_agent/
â”œâ”€â”€ frontend/                 # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/             # Next.jsé¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/   # ä»ªè¡¨æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ reports/     # æŠ¥å‘Šç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ files/       # æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ ai/          # AIåŠ©æ‰‹
â”‚   â”‚   â”‚   â””â”€â”€ templates/   # æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ components/      # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/           # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ types/           # TypeScriptç±»å‹
â”‚   â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ next.config.js
â”‚
â”œâ”€â”€ backend/                  # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/             # APIè·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ v1/          # APIç‰ˆæœ¬1
â”‚   â”‚   â”‚       â”œâ”€â”€ auth.py      # è®¤è¯æ¥å£
â”‚   â”‚   â”‚       â”œâ”€â”€ reports.py   # æŠ¥å‘Šæ¥å£
â”‚   â”‚   â”‚       â”œâ”€â”€ files.py     # æ–‡ä»¶æ¥å£
â”‚   â”‚   â”‚       â”œâ”€â”€ ai.py        # AIæ¥å£
â”‚   â”‚   â”‚       â””â”€â”€ templates.py # æ¨¡æ¿æ¥å£
â”‚   â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ db/              # æ•°æ®åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py    # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ config.py    # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ schemas/         # Pydanticæ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ main.py
â”‚
â”œâ”€â”€ docker-compose.yml        # Dockerç¼–æ’
â”œâ”€â”€ README.md
â””â”€â”€ .gitignore
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- Python 3.8+
- PostgreSQL 13+
- Redis 6+

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd pila_agent
```

2. **åç«¯è®¾ç½®**
```bash
cd backend
pip install -r requirements.txt

# è®¾ç½®ç¯å¢ƒå˜é‡
export DATABASE_URL="postgresql://user:password@localhost/dbname"
export REDIS_URL="redis://localhost:6379"
export OPENAI_API_KEY="your-openai-api-key"

# å¯åŠ¨åç«¯æœåŠ¡
python main.py
```

3. **å‰ç«¯è®¾ç½®**
```bash
cd frontend
npm install

# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm run dev
```

4. **è®¿é—®åº”ç”¨**
- å‰ç«¯: http://localhost:3000
- åç«¯API: http://localhost:8000
- APIæ–‡æ¡£: http://localhost:8000/docs

## ğŸ“‹ åŠŸèƒ½æ¨¡å—è¯¦è§£

### 1. ä»ªè¡¨æ¿ (Dashboard)
- **è·¯å¾„**: `/dashboard`
- **åŠŸèƒ½**: 
  - æŠ¥å‘Šæ¦‚è§ˆå’Œç»Ÿè®¡
  - å¿«é€Ÿåˆ›å»ºæŠ¥å‘Š
  - æœ€è¿‘æ´»åŠ¨å±•ç¤º
  - ç³»ç»Ÿå…¬å‘Š

### 2. æŠ¥å‘Šç®¡ç† (Reports)
- **è·¯å¾„**: `/reports`
- **åŠŸèƒ½**:
  - æŠ¥å‘Šåˆ—è¡¨æŸ¥çœ‹
  - åˆ›å»ºæ–°æŠ¥å‘Š: `/reports/create`
  - ç¼–è¾‘æŠ¥å‘Š: `/reports/[id]/edit`
  - æŸ¥çœ‹æŠ¥å‘Š: `/reports/[id]/view`
  - åˆ é™¤å’Œå½’æ¡£æŠ¥å‘Š

### 3. æ–‡ä»¶ç®¡ç† (Files)
- **è·¯å¾„**: `/files`
- **åŠŸèƒ½**:
  - æ–‡ä»¶ä¸Šä¼ : `/files/upload`
  - OCRè¯†åˆ«å¤„ç†
  - æ–‡ä»¶é¢„è§ˆå’Œä¸‹è½½
  - æ‰¹é‡æ“ä½œ

### 4. AIåŠ©æ‰‹ (AI Assistant)
- **è·¯å¾„**: `/ai/assistant`
- **åŠŸèƒ½**:
  - æ™ºèƒ½å¯¹è¯å’¨è¯¢
  - ç« èŠ‚å†…å®¹ç”Ÿæˆ
  - ä¸“ä¸šçŸ¥è¯†é—®ç­”
  - å†™ä½œå»ºè®®

### 5. æ¨¡æ¿ç®¡ç† (Templates)
- **è·¯å¾„**: `/templates`
- **åŠŸèƒ½**:
  - æŸ¥çœ‹æ¨¡æ¿åº“
  - åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿
  - ç¼–è¾‘æ¨¡æ¿å†…å®¹
  - æ¨¡æ¿åˆ†ç±»ç®¡ç†

## ğŸ”Œ APIæ¥å£

### åç«¯APIè·¯ç”±

#### æŠ¥å‘Šç›¸å…³ `/api/v1/reports`
- `GET /` - è·å–æŠ¥å‘Šåˆ—è¡¨
- `POST /` - åˆ›å»ºæ–°æŠ¥å‘Š
- `GET /{id}` - è·å–æŠ¥å‘Šè¯¦æƒ…
- `PUT /{id}` - æ›´æ–°æŠ¥å‘Š
- `DELETE /{id}` - åˆ é™¤æŠ¥å‘Š
- `POST /{id}/export` - å¯¼å‡ºæŠ¥å‘Š

#### æ–‡ä»¶ç›¸å…³ `/api/v1/files`
- `POST /upload` - ä¸Šä¼ æ–‡ä»¶
- `GET /` - è·å–æ–‡ä»¶åˆ—è¡¨
- `GET /{id}` - è·å–æ–‡ä»¶è¯¦æƒ…
- `DELETE /{id}` - åˆ é™¤æ–‡ä»¶
- `POST /{id}/ocr` - è§¦å‘OCRå¤„ç†

#### AIç›¸å…³ `/api/v1/ai`
- `POST /generate/{report_id}` - ç”Ÿæˆç« èŠ‚å†…å®¹
- `GET /templates/{chapter_type}` - è·å–æç¤ºè¯æ¨¡æ¿
- `GET /history/{report_id}` - è·å–ç”Ÿæˆå†å²
- `POST /chat` - AIå¯¹è¯

#### æ¨¡æ¿ç›¸å…³ `/api/v1/templates`
- `GET /` - è·å–æ¨¡æ¿åˆ—è¡¨
- `POST /` - åˆ›å»ºæ¨¡æ¿
- `GET /{id}` - è·å–æ¨¡æ¿è¯¦æƒ…
- `PUT /{id}` - æ›´æ–°æ¨¡æ¿
- `DELETE /{id}` - åˆ é™¤æ¨¡æ¿
- `GET /types/available` - è·å–å¯ç”¨æ¨¡æ¿ç±»å‹

## ğŸ“Š æ•°æ®æ¨¡å‹

### æ ¸å¿ƒæ¨¡å‹

#### æŠ¥å‘Šæ¨¡å‹ (ReportDraft)
```python
class ReportDraft:
    id: int
    title: str
    insurance_type: InsuranceType
    status: ReportStatus
    owner_id: int
    
    # æŠ¥å‘Šç« èŠ‚
    accident_details: str
    policy_summary: str
    site_investigation: str
    cause_analysis: str
    loss_assessment: str
    conclusion: str
    
    created_at: datetime
    updated_at: datetime
```

#### æ–‡ä»¶æ¨¡å‹ (UploadedFile)
```python
class UploadedFile:
    id: int
    filename: str
    file_path: str
    file_size: int
    mime_type: str
    ocr_status: OCRStatus
    ocr_result: str
    report_id: int
    uploaded_by: int
    created_at: datetime
```

#### AIç”Ÿæˆæ—¥å¿— (AIGenerationLog)
```python
class AIGenerationLog:
    id: int
    report_id: int
    chapter_type: str
    prompt_text: str
    generated_content: str
    model_name: str
    tokens_used: int
    generation_time: float
    created_at: datetime
```

## ğŸ¨ UIç»„ä»¶è§„èŒƒ

### è®¾è®¡ç³»ç»Ÿ
- **è‰²å½©ä¸»é¢˜**: è“è‰²ç³»ä¸»è‰²è°ƒï¼Œç¬¦åˆä¿é™©è¡Œä¸šè§„èŒƒ
- **å­—ä½“**: æ€æºé»‘ä½“ï¼Œä¿è¯ä¸­æ–‡æ˜¾ç¤ºæ•ˆæœ
- **é—´è·**: 8pxåŸºç¡€å•ä½çš„å€æ•°
- **åœ†è§’**: 8pxæ ‡å‡†åœ†è§’

### ç»„ä»¶åº“
- æŒ‰é’® (Button)
- è¡¨å• (Form) 
- è¡¨æ ¼ (Table)
- å¯¹è¯æ¡† (Modal)
- æç¤ºä¿¡æ¯ (Toast)
- åŠ è½½çŠ¶æ€ (Loading)

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **è®¤è¯æœºåˆ¶**: JWT Tokenè®¤è¯
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- **é˜²æŠ¤æªæ–½**: XSSã€CSRFé˜²æŠ¤
- **å®¡è®¡æ—¥å¿—**: æ“ä½œæ—¥å¿—è®°å½•

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **å‰ç«¯ä¼˜åŒ–**: 
  - ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
  - å›¾ç‰‡ä¼˜åŒ–å’ŒCDN
  - Service Workerç¼“å­˜
  
- **åç«¯ä¼˜åŒ–**:
  - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
  - Redisç¼“å­˜ç­–ç•¥
  - APIå“åº”å‹ç¼©

## ğŸ§ª æµ‹è¯•ç­–ç•¥

- **å•å…ƒæµ‹è¯•**: Jest + React Testing Library
- **é›†æˆæµ‹è¯•**: Playwrightç«¯åˆ°ç«¯æµ‹è¯•
- **APIæµ‹è¯•**: pytest + httpx
- **æ€§èƒ½æµ‹è¯•**: å‹åŠ›æµ‹è¯•å’Œæ€§èƒ½ç›‘æ§

## ğŸ“¦ éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²
```bash
# æ„å»ºå’Œå¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
1. ç¯å¢ƒå˜é‡é…ç½®
2. æ•°æ®åº“è¿ç§»
3. é™æ€æ–‡ä»¶å¤„ç†
4. Nginxåå‘ä»£ç†
5. SSLè¯ä¹¦é…ç½®

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ
- éµå¾ªTypeScriptä¸¥æ ¼æ¨¡å¼
- ä½¿ç”¨ESLintå’ŒPrettier
- éµå¾ªGitæäº¤è§„èŒƒ
- ç»„ä»¶å’Œå‡½æ•°å¿…é¡»æ·»åŠ JSDocæ³¨é‡Š

### åˆ†æ”¯ç­–ç•¥
- `main`: ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯
- `develop`: å¼€å‘ç¯å¢ƒåˆ†æ”¯
- `feature/*`: åŠŸèƒ½å¼€å‘åˆ†æ”¯
- `hotfix/*`: ç´§æ€¥ä¿®å¤åˆ†æ”¯

### æäº¤è§„èŒƒ
```
feat: æ–°åŠŸèƒ½
fix: é”™è¯¯ä¿®å¤
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼ä¿®æ”¹
refactor: ä»£ç é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»ºå’Œå·¥å…·ä¿®æ”¹
```

## ğŸ“„ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-03-16)
- âœ¨ å®Œæˆä»ªè¡¨æ¿é¡µé¢åŠŸèƒ½å®ç°
- âœ¨ å®ç°æŠ¥å‘Šåˆ›å»ºå’Œç¼–è¾‘åŠŸèƒ½
- âœ¨ æ·»åŠ æ–‡ä»¶ä¸Šä¼ å’ŒOCRå¤„ç†
- âœ¨ é›†æˆAIç« èŠ‚ç”ŸæˆåŠŸèƒ½
- âœ¨ å®ç°æ¨¡æ¿ç®¡ç†ç³»ç»Ÿ
- âœ¨ æ·»åŠ AIåŠ©æ‰‹å¯¹è¯åŠŸèƒ½
- ğŸ› ä¿®å¤å¤šä¸ªUIå’ŒAPIé—®é¢˜
- ğŸ“ å®Œå–„é¡¹ç›®æ–‡æ¡£

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç å˜æ›´
4. å‘èµ·Pull Request
5. ä»£ç å®¡æŸ¥å’Œåˆå¹¶

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®ç»´æŠ¤è€…: å¼€å‘å›¢é˜Ÿ
- é‚®ç®±: dev@example.com
- é—®é¢˜åé¦ˆ: GitHub Issues

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

**å…¬ä¼°æŠ¥å‘Šæ™ºèƒ½æ’°å†™åŠ©æ‰‹** - è®©ä¿é™©ç†èµ”æŠ¥å‘Šæ’°å†™æ›´æ™ºèƒ½ã€æ›´é«˜æ•ˆï¼ 